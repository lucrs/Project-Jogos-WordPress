/*!
 * @package Content Aware Sidebars
 * @author Joachim Jensen <jv@intox.dk>
 * @license GPLv3
 * @copyright 2017 by Joachim Jensen
 */
!function(a){var b={$sidebarContainer:a(".widget-liquid-right"),$widgetContainer:a("#available-widgets"),init:function(){this.addSidebarToolbar(),this.addWidgetSearch(),this.toggleSidebarStatus(),this.enhancedWidgetManager()},enhancedWidgetManager:function(){if(a("body").hasClass("cas-widget-manager")){this.$widgetContainer.find(".widget").draggable("option","scroll",!1);var b=this,c=a("#widgets-left .inactive-sidebar");c.toggle(this.$widgetContainer.hasClass("closed")),this.$widgetContainer.find(".sidebar-name").click(function(a){c.toggle(b.$widgetContainer.hasClass("closed"))})}},toggleSidebarStatus:function(){a(".widget-liquid-right").on("change",".sidebar-status-input",function(b){var c=a(this),d=c.is(":checked");!c.hasClass("sidebar-status-future")||confirm(CASAdmin.enableConfirm)?a.post(ajaxurl,{action:"cas_sidebar_status",sidebar_id:c.val(),status:d},function(a){a.success?(c.next().attr("title",a.data.title),c.removeClass("sidebar-status-future")):c.attr("checked",!d)}):c.attr("checked",!d)})},addWidgetSearch:function(){var b=a(".widget",this.$widgetContainer).get().reverse();a(".sidebar-description",this.$widgetContainer).prepend('<input type="search" class="js-cas-widget-filter cas-filter-widget" placeholder="'+CASAdmin.filterWidgets+'...">'),this.searchWidgetListener(b)},searchWidgetListener:function(b){var c,d="";this.$widgetContainer.on("input",".js-cas-widget-filter",function(e){var f=a(this).val();f!=d&&(d=f,c&&clearTimeout(c),c=setTimeout(function(){a(b).each(function(b,c){var d=a(c);d.find(".widget-title :nth-child(1)").text().search(new RegExp(f,"i"))<0?d.fadeOut():(d.prependTo(d.parent()),d.fadeIn().css("display",""))})},250))})},addSidebarToolbar:function(){var a='<div class="wp-filter cas-filter-sidebar"><a href="admin.php?page=wpcas-edit" class="button button-primary">'+CASAdmin.addNew+'</a><input type="search" class="js-cas-filter" placeholder="'+CASAdmin.filterSidebars+'..."><a href="#" title="'+CASAdmin.collapse+'" class="js-sidebars-toggle sidebars-toggle" data-toggle="0"><span class="dashicons dashicons-arrow-up-alt2"></span></a><a href="#" title="'+CASAdmin.expand+'" class="js-sidebars-toggle sidebars-toggle" data-toggle="1"><span class="dashicons dashicons-arrow-down-alt2"></span></a></div>';this.$sidebarContainer.prepend(a),this.searchSidebarListener(),this.addSidebarToggle()},addSidebarToggle:function(){var b=a(document),c=this.$sidebarContainer.find(".widgets-holder-wrap");a("body").on("click",".js-sidebars-toggle",function(d){d.preventDefault();var e=!!a(this).data("toggle");c.toggleClass("closed",!e),e&&c.children(".widgets-sortables").sortable("refresh"),b.triggerHandler("wp-pin-menu")})},searchSidebarListener:function(){var b,c=this,d="";this.$sidebarContainer.on("input",".js-cas-filter",function(e){var f=a(this).val();f!=d&&(d=f,b&&clearTimeout(b),b=setTimeout(function(){a(".widgets-holder-wrap",c.$sidebarContainer).each(function(b,c){var d=a(c);d.find(".sidebar-name :nth-child(2)").text().search(new RegExp(f,"i"))<0?d.fadeOut():d.fadeIn()})},250))})}};a(document).ready(function(){b.init()})}(jQuery);